<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Valentine's Day, Ryan! üíï</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Caveat:wght@400;600;700&family=Lora:ital@0;1&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --rose: #c9485b;
    --deep-rose: #8b1a2b;
    --blush: #f4c2c2;
    --cream: #fdf6ec;
    --gold: #d4a574;
    --brown: #5c3a21;
    --grass-light: #7cb342;
    --grass-mid: #558b2f;
    --grass-dark: #33691e;
    --sky-top: #87ceeb;
    --sky-bottom: #e0f0ff;
  }

  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    font-family: 'Lora', serif;
    cursor: default;
    user-select: none;
  }

  /* ---- Sky & scenery ---- */
  #scene {
    position: fixed; inset: 0;
    background: linear-gradient(180deg, var(--sky-top) 0%, var(--sky-bottom) 55%, var(--grass-light) 55.5%, var(--grass-mid) 70%, var(--grass-dark) 100%);
    overflow: hidden;
  }

  /* Clouds */
  .cloud {
    position: absolute;
    background: #fff;
    border-radius: 50%;
    opacity: .7;
    filter: blur(2px);
  }
  .cloud::before, .cloud::after {
    content: ''; position: absolute; background: #fff; border-radius: 50%;
  }

  /* ---- Mallard Duck ---- */
  .mallard {
    position: absolute;
    z-index: 3;
    pointer-events: none;
  }
  .mallard svg { overflow: visible; }
  .mallard .wing-top {
    animation: flapWing 0.3s ease-in-out infinite alternate;
    transform-origin: 55px 40px;
  }
  @keyframes flapWing {
    0% { transform: rotate(-25deg); }
    100% { transform: rotate(20deg); }
  }

  /* Grass blades overlay */
  #grass-overlay {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 45%;
    pointer-events: none;
    z-index: 1;
  }

  /* Floating hearts in sky */
  .floating-heart {
    position: absolute;
    color: var(--blush);
    font-size: 18px;
    opacity: 0.4;
    animation: floatUp linear infinite;
    pointer-events: none;
    z-index: 0;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 0.4; }
    50% { opacity: 0.6; }
    100% { transform: translateY(-100vh) rotate(360deg) scale(0.5); opacity: 0; }
  }

  /* ---- Title ---- */
  #title-banner {
    position: fixed;
    top: 16px; left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    text-align: center;
    animation: titleDrop 1.2s cubic-bezier(.34,1.56,.64,1) forwards;
    opacity: 0;
  }
  @keyframes titleDrop {
    0% { opacity: 0; transform: translateX(-50%) translateY(-60px) scale(0.8); }
    100% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
  }
  #title-banner h1 {
    font-family: 'Caveat', cursive;
    font-size: clamp(28px, 5vw, 56px);
    color: var(--deep-rose);
    text-shadow: 0 2px 8px rgba(139,26,43,.2);
    line-height: 1.1;
  }
  #title-banner p {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: clamp(12px, 2vw, 18px);
    color: var(--rose);
    margin-top: 4px;
  }

  /* ---- Treat bowl ---- */
  #treat-bowl {
    position: fixed;
    bottom: 18px; right: 24px;
    z-index: 500;
    text-align: center;
    animation: bowlBounce 2s ease-in-out infinite;
  }
  @keyframes bowlBounce {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }
  #treat-bowl .bowl-label {
    font-family: 'Caveat', cursive;
    font-size: 16px;
    color: var(--brown);
    margin-bottom: 4px;
    text-shadow: 0 1px 2px rgba(0,0,0,.15);
  }

  .treat {
    width: 50px; height: 50px;
    cursor: grab;
    position: relative;
    display: inline-block;
    z-index: 501;
    transition: transform 0.15s;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
  }
  .treat:hover { transform: scale(1.15); }
  .treat.dragging {
    cursor: grabbing;
    position: fixed;
    z-index: 10000;
    transform: scale(1.2);
    pointer-events: none;
  }

  /* ---- Dachshund container ---- */
  .dachshund-group {
    position: absolute;
    z-index: 10;
    cursor: pointer;
    transition: filter 0.3s;
  }
  .dachshund-group:hover { filter: brightness(1.05); }

  .dachshund-wrapper {
    position: relative;
    width: 180px;
    height: 120px;
  }

  /* Bark bubble */
  .bark-bubble {
    position: absolute;
    top: -38px; left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 2px solid var(--brown);
    border-radius: 16px;
    padding: 4px 12px;
    font-family: 'Caveat', cursive;
    font-size: 16px;
    font-weight: 700;
    color: var(--brown);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 50;
  }
  .bark-bubble::after {
    content: '';
    position: absolute;
    bottom: -8px; left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 8px solid white;
  }
  .bark-bubble.visible { opacity: 1; }

  /* Heart envelope floating above dachshund */
  .heart-envelope {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    animation: envelopeBob 2s ease-in-out infinite;
    pointer-events: none;
  }
  @keyframes envelopeBob {
    0%,100% { transform: translateX(-50%) translateY(0) rotate(-3deg); }
    50% { transform: translateX(-50%) translateY(-6px) rotate(3deg); }
  }

  /* Walking animation */
  .walking {
    animation: walkCycle 0.4s steps(2) infinite;
  }
  @keyframes walkCycle {
    0% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0); }
  }

  /* ---- Message overlay ---- */
  #message-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,.55);
    z-index: 9000;
    display: none;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.4s ease;
    backdrop-filter: blur(4px);
  }
  #message-overlay.active { display: flex; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .message-card {
    background: var(--cream);
    border: 3px solid var(--rose);
    border-radius: 20px;
    padding: 40px 48px;
    max-width: 440px;
    width: 90%;
    text-align: center;
    position: relative;
    box-shadow: 0 20px 60px rgba(139,26,43,.3), inset 0 0 40px rgba(244,194,194,.3);
    animation: cardPop 0.5s cubic-bezier(.34,1.56,.64,1) forwards;
  }
  @keyframes cardPop {
    0% { transform: scale(0.5) rotate(-5deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }
  .message-card .heart-top {
    font-size: 42px;
    margin-bottom: 12px;
    animation: heartbeat 1s ease-in-out infinite;
  }
  @keyframes heartbeat {
    0%,100% { transform: scale(1); }
    15% { transform: scale(1.15); }
    30% { transform: scale(1); }
    45% { transform: scale(1.1); }
    60% { transform: scale(1); }
  }
  .message-card .msg-text {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    color: var(--deep-rose);
    line-height: 1.6;
    margin-bottom: 20px;
  }
  .message-card .close-btn {
    font-family: 'Caveat', cursive;
    font-size: 18px;
    background: var(--rose);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 10px 32px;
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
  }
  .message-card .close-btn:hover {
    background: var(--deep-rose);
    transform: scale(1.05);
  }
  .surprise-btn {
    font-family: 'Caveat', cursive;
    font-size: 22px;
    background: linear-gradient(135deg, #d4a574, #c9485b);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 14px 36px;
    cursor: pointer;
    margin-top: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 16px rgba(201,72,91,0.3);
    animation: surprisePulse 1.5s ease-in-out infinite;
  }
  .surprise-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 6px 24px rgba(201,72,91,0.45);
  }
  @keyframes surprisePulse {
    0%,100% { box-shadow: 0 4px 16px rgba(201,72,91,0.3); }
    50% { box-shadow: 0 4px 24px rgba(201,72,91,0.55); }
  }

  /* Dachshund fed state ‚Äî happy wiggle */
  .dachshund-group.fed .dachshund-wrapper {
    animation: happyWiggle 0.6s ease-in-out 3;
  }
  @keyframes happyWiggle {
    0%,100% { transform: rotate(0); }
    25% { transform: rotate(-3deg); }
    75% { transform: rotate(3deg); }
  }

  /* ---- Instruction tooltip ---- */
  #instructions {
    position: fixed;
    bottom: 24px; left: 24px;
    z-index: 500;
    background: rgba(255,255,255,.92);
    border: 2px solid var(--blush);
    border-radius: 14px;
    padding: 12px 18px;
    max-width: 260px;
    font-family: 'Caveat', cursive;
    font-size: 17px;
    color: var(--brown);
    box-shadow: 0 4px 16px rgba(0,0,0,.1);
    animation: slideUp 0.8s ease forwards;
    line-height: 1.4;
  }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  #instructions span { color: var(--rose); font-weight: 700; }

  /* Score */
  #score {
    position: fixed;
    top: 18px; right: 24px;
    z-index: 1000;
    font-family: 'Caveat', cursive;
    font-size: 22px;
    color: var(--deep-rose);
    background: rgba(255,255,255,.85);
    border-radius: 20px;
    padding: 6px 18px;
    box-shadow: 0 2px 10px rgba(0,0,0,.1);
  }

  /* Grass detail patches */
  .grass-tuft {
    position: absolute;
    bottom: 0;
    width: 30px; height: 40px;
    pointer-events: none;
    z-index: 2;
  }
</style>
</head>
<body>

<div id="scene">
  <canvas id="grass-canvas" style="position:absolute;bottom:0;left:0;width:100%;height:45%;z-index:1;pointer-events:none;"></canvas>
</div>

<div id="title-banner">
  <h1>Happy Valentine's Day, Ryan! üíï</h1>
  <p>Feed the pups to read Kaydee's love notes!</p>
</div>

<div id="score">ü¶¥ <span id="fed-count">0</span> / <span id="total-count">0</span> pups fed</div>

<div id="treat-bowl">
  <div class="bowl-label">ü¶¥ Drag a treat! ü¶¥</div>
  <svg class="treat" id="treat-source" viewBox="0 0 60 60">
    <ellipse cx="30" cy="32" rx="22" ry="14" fill="#d4a574" stroke="#8b6f47" stroke-width="2"/>
    <ellipse cx="30" cy="28" rx="18" ry="10" fill="#e8c49a"/>
    <circle cx="22" cy="28" r="3" fill="#c9485b" opacity="0.7"/>
    <circle cx="34" cy="26" r="2.5" fill="#c9485b" opacity="0.7"/>
    <circle cx="28" cy="32" r="2" fill="#c9485b" opacity="0.5"/>
    <text x="30" y="37" text-anchor="middle" font-size="8" fill="#8b6f47" font-family="Caveat">treat</text>
  </svg>
</div>

<div id="instructions">
  üêï Drag a <span>treat</span> to each dachshund to stop their barking and reveal a <span>love note</span> in their heart envelope!
</div>

<div id="message-overlay" onclick="closeMessage(event)">
  <div class="message-card" onclick="event.stopPropagation()">
    <div class="heart-top">üíå</div>
    <div class="msg-text" id="msg-text"></div>
    <button class="close-btn" onclick="closeMessage()">Aww, next pup! üêæ</button>
  </div>
</div>

<script>
// ============ CONFIG ============
const MESSAGES = [
  "You make my heart do zoomies, just like a dachshund chasing apples. üêæüíï",
  "You make me the happiest girl in the world and always fill my cup. I look forward to seeing your face every morning when I wake up üåü",
  "If love were measured in wiener-dog lengths, we'd win by a long stretch (Because we're winners DUH) üåô",
  "I never thought I would meet a man as in tune and loving as you are, thank you for making me feel provided for and protected. ‚ù§Ô∏è",
  "Every moment with you feels like coming home. Thank you for being my safe space ‚Äî my best friend, my partner in crime, my everlasting love. üè°üíó",
];

const BARK_SOUNDS_TEXT = ["Woof!", "Arf!", "Yap!", "Bark!", "Ruff!"];

// ============ STATE ============
let dogs = [];
let dragging = null;
let dragOffsetX = 0, dragOffsetY = 0;
let fedCount = 0;
let audioCtx = null;

// ============ AUDIO ============
function initAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function playBark() {
  if (!audioCtx) return;
  try {
    const t = audioCtx.currentTime;
    // Each bark is two sharp bursts (like a real "arf arf")
    const burstCount = Math.random() > 0.5 ? 2 : 1;
    for (let b = 0; b < burstCount; b++) {
      const offset = b * 0.18;

      // Noise burst for the breathy/raspy part
      const bufferSize = audioCtx.sampleRate * 0.12;
      const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const noiseData = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        noiseData[i] = (Math.random() * 2 - 1);
      }
      const noise = audioCtx.createBufferSource();
      noise.buffer = noiseBuffer;

      // Bandpass filter to shape the noise into a bark tone
      const bp = audioCtx.createBiquadFilter();
      bp.type = 'bandpass';
      bp.frequency.value = 600 + Math.random() * 400;
      bp.Q.value = 2;

      const noiseGain = audioCtx.createGain();
      noiseGain.gain.setValueAtTime(0, t + offset);
      noiseGain.gain.linearRampToValueAtTime(0.12, t + offset + 0.01);
      noiseGain.gain.exponentialRampToValueAtTime(0.001, t + offset + 0.1);

      noise.connect(bp);
      bp.connect(noiseGain);
      noiseGain.connect(audioCtx.destination);
      noise.start(t + offset);
      noise.stop(t + offset + 0.12);

      // Tonal component ‚Äî sharp pitch drop like a real bark
      const osc = audioCtx.createOscillator();
      const oscGain = audioCtx.createGain();
      osc.type = 'sawtooth';
      const pitch = 350 + Math.random() * 250;
      osc.frequency.setValueAtTime(pitch * 1.6, t + offset);
      osc.frequency.exponentialRampToValueAtTime(pitch * 0.6, t + offset + 0.08);
      oscGain.gain.setValueAtTime(0, t + offset);
      oscGain.gain.linearRampToValueAtTime(0.06, t + offset + 0.008);
      oscGain.gain.exponentialRampToValueAtTime(0.001, t + offset + 0.09);

      // Slight distortion for grit
      const waveshaper = audioCtx.createWaveShaper();
      const curve = new Float32Array(256);
      for (let i = 0; i < 256; i++) {
        const x = (i * 2) / 256 - 1;
        curve[i] = Math.tanh(x * 2.5);
      }
      waveshaper.curve = curve;

      osc.connect(waveshaper);
      waveshaper.connect(oscGain);
      oscGain.connect(audioCtx.destination);
      osc.start(t + offset);
      osc.stop(t + offset + 0.1);
    }
  } catch(e) {}
}

function playHappy() {
  if (!audioCtx) return;
  try {
    [0, 0.12, 0.24].forEach((delay, i) => {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.type = 'sine';
      osc.frequency.setValueAtTime(400 + i * 100, audioCtx.currentTime + delay);
      gain.gain.setValueAtTime(0.07, audioCtx.currentTime + delay);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + 0.15);
      osc.start(audioCtx.currentTime + delay);
      osc.stop(audioCtx.currentTime + delay + 0.15);
    });
  } catch(e) {}
}

// ============ DRAW DACHSHUND (SVG) ============
function createDachshundSVG(facing) {
  const flip = facing === 'left' ? 'transform="scale(-1,1) translate(-180,0)"' : '';
  return `
  <svg viewBox="0 0 180 120" width="180" height="120" xmlns="http://www.w3.org/2000/svg">
    <g ${flip}>
      <!-- Shadow -->
      <ellipse cx="90" cy="112" rx="60" ry="6" fill="rgba(0,0,0,0.12)"/>

      <!-- Back legs -->
      <rect x="38" y="82" width="10" height="26" rx="4" fill="#5c3a21"/>
      <rect x="50" y="82" width="10" height="26" rx="4" fill="#6b4423"/>
      <ellipse cx="43" cy="108" rx="7" ry="4" fill="#3e2712"/>
      <ellipse cx="55" cy="108" rx="7" ry="4" fill="#4a2f16"/>

      <!-- Front legs -->
      <rect x="118" y="82" width="10" height="26" rx="4" fill="#5c3a21"/>
      <rect x="130" y="82" width="10" height="26" rx="4" fill="#6b4423"/>
      <ellipse cx="123" cy="108" rx="7" ry="4" fill="#3e2712"/>
      <ellipse cx="135" cy="108" rx="7" ry="4" fill="#4a2f16"/>

      <!-- Tail -->
      <path d="M28,68 Q18,50 24,38" stroke="#5c3a21" stroke-width="5" fill="none" stroke-linecap="round" class="tail"/>

      <!-- Body -->
      <ellipse cx="90" cy="74" rx="58" ry="20" fill="#6b4423"/>
      <ellipse cx="90" cy="72" rx="55" ry="18" fill="#7a5230"/>
      <!-- Belly highlight -->
      <ellipse cx="90" cy="80" rx="40" ry="8" fill="#8b6340" opacity="0.5"/>

      <!-- Chest -->
      <ellipse cx="135" cy="72" rx="18" ry="18" fill="#7a5230"/>

      <!-- Head -->
      <ellipse cx="155" cy="56" rx="20" ry="18" fill="#6b4423"/>
      <ellipse cx="155" cy="54" rx="19" ry="16" fill="#7a5230"/>

      <!-- Snout -->
      <ellipse cx="170" cy="60" rx="12" ry="9" fill="#8b6340"/>
      <ellipse cx="170" cy="58" rx="11" ry="7" fill="#926b48"/>

      <!-- Nose -->
      <ellipse cx="178" cy="57" rx="4" ry="3" fill="#2a1a0a"/>
      <ellipse cx="177.5" cy="56.2" rx="1.5" ry="1" fill="#5a3a1a" opacity="0.4"/>

      <!-- Eye -->
      <ellipse cx="158" cy="50" rx="4.5" ry="5" fill="#1a0f05"/>
      <ellipse cx="159" cy="48.5" rx="1.8" ry="2" fill="white" opacity="0.6"/>

      <!-- Eyebrow -->
      <ellipse cx="156" cy="44" rx="6" ry="1.5" fill="#5c3a21"/>

      <!-- Ear -->
      <ellipse cx="146" cy="46" rx="12" ry="18" fill="#5c3a21" transform="rotate(-15,146,46)"/>
      <ellipse cx="146" cy="48" rx="9" ry="14" fill="#4a2f16" transform="rotate(-15,146,48)"/>

      <!-- Mouth / jaw line -->
      <path d="M168,62 Q172,66 176,63" stroke="#4a2f16" stroke-width="1" fill="none"/>

      <!-- Collar -->
      <rect x="126" y="66" width="22" height="6" rx="3" fill="#c9485b"/>
      <circle cx="137" cy="72" r="3.5" fill="#d4a574" stroke="#b8944a" stroke-width="0.5"/>

      <!-- Fur texture lines -->
      <line x1="60" y1="66" x2="65" y2="64" stroke="#5c3a21" stroke-width="0.5" opacity="0.4"/>
      <line x1="80" y1="64" x2="86" y2="62" stroke="#5c3a21" stroke-width="0.5" opacity="0.4"/>
      <line x1="100" y1="66" x2="106" y2="64" stroke="#5c3a21" stroke-width="0.5" opacity="0.4"/>
      <line x1="110" y1="62" x2="115" y2="60" stroke="#5c3a21" stroke-width="0.5" opacity="0.4"/>
    </g>
  </svg>`;
}

function createHeartEnvelopeSVG() {
  return `<svg viewBox="0 0 50 50" width="44" height="44">
    <!-- envelope body -->
    <rect x="8" y="18" width="34" height="24" rx="3" fill="#fdf6ec" stroke="#c9485b" stroke-width="1.5"/>
    <!-- envelope flap -->
    <path d="M8,18 L25,32 L42,18" fill="none" stroke="#c9485b" stroke-width="1.5"/>
    <!-- heart on top -->
    <path d="M25,8 C25,8 18,2 14,8 C10,14 18,20 25,26 C32,20 40,14 36,8 C32,2 25,8 25,8Z" fill="#c9485b"/>
    <path d="M25,10 C25,10 20,5 17,9 C14.5,12.5 19,17 25,22" fill="#e05070" opacity="0.4"/>
  </svg>`;
}

// ============ CREATE DOGS ============
function createDog(index) {
  const scene = document.getElementById('scene');
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  // Position in the grass area (bottom 40%)
  const grassTop = vh * 0.56;
  const grassBottom = vh * 0.88;
  const x = 80 + (index * (vw - 200) / (MESSAGES.length));
  const y = grassTop + Math.random() * (grassBottom - grassTop - 120);

  const group = document.createElement('div');
  group.className = 'dachshund-group';
  group.style.left = x + 'px';
  group.style.top = y + 'px';
  group.dataset.index = index;
  group.id = 'dog-' + index;

  const facing = Math.random() > 0.5 ? 'right' : 'left';

  // Heart envelope
  const envDiv = document.createElement('div');
  envDiv.className = 'heart-envelope';
  envDiv.innerHTML = createHeartEnvelopeSVG();
  
  // Bark bubble
  const bark = document.createElement('div');
  bark.className = 'bark-bubble';
  bark.textContent = 'Woof!';

  // Dog SVG
  const wrapper = document.createElement('div');
  wrapper.className = 'dachshund-wrapper walking';
  wrapper.innerHTML = createDachshundSVG(facing);

  group.appendChild(bark);
  group.appendChild(envDiv);
  group.appendChild(wrapper);
  scene.appendChild(group);

  const dog = {
    el: group,
    wrapper,
    bark,
    envDiv,
    x, y,
    vx: (Math.random() - 0.5) * 1.2,
    vy: (Math.random() - 0.5) * 0.4,
    facing,
    fed: false,
    index,
    barkTimer: null,
    moveTimer: null,
    message: MESSAGES[index],
  };

  // Start barking
  startBarking(dog);
  // Start wandering
  startWandering(dog);

  return dog;
}

function startBarking(dog) {
  if (dog.fed) return;
  const doBark = () => {
    if (dog.fed) return;
    dog.bark.textContent = BARK_SOUNDS_TEXT[Math.floor(Math.random() * BARK_SOUNDS_TEXT.length)];
    dog.bark.classList.add('visible');
    playBark();
    setTimeout(() => {
      dog.bark.classList.remove('visible');
    }, 600);
    dog.barkTimer = setTimeout(doBark, 2000 + Math.random() * 3000);
  };
  dog.barkTimer = setTimeout(doBark, Math.random() * 2000);
}

function startWandering(dog) {
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const grassTop = vh * 0.54;
  const grassBottom = vh * 0.85;

  const move = () => {
    if (dog.fed) {
      dog.wrapper.classList.remove('walking');
      return;
    }

    // Change direction occasionally
    if (Math.random() < 0.3) {
      dog.vx = (Math.random() - 0.5) * 1.5;
      dog.vy = (Math.random() - 0.5) * 0.5;
    }

    dog.x += dog.vx;
    dog.y += dog.vy;

    // Bounds
    if (dog.x < 20) { dog.x = 20; dog.vx *= -1; }
    if (dog.x > vw - 200) { dog.x = vw - 200; dog.vx *= -1; }
    if (dog.y < grassTop) { dog.y = grassTop; dog.vy *= -1; }
    if (dog.y > grassBottom) { dog.y = grassBottom; dog.vy *= -1; }

    // Flip direction
    const newFacing = dog.vx > 0 ? 'right' : 'left';
    if (newFacing !== dog.facing) {
      dog.facing = newFacing;
      dog.wrapper.innerHTML = createDachshundSVG(newFacing);
    }

    dog.el.style.left = dog.x + 'px';
    dog.el.style.top = dog.y + 'px';

    dog.moveTimer = setTimeout(move, 80);
  };
  dog.moveTimer = setTimeout(move, Math.random() * 500);
}

function feedDog(dog) {
  if (dog.fed) return;
  dog.fed = true;
  fedCount++;
  document.getElementById('fed-count').textContent = fedCount;

  // Stop barking
  clearTimeout(dog.barkTimer);
  dog.bark.classList.remove('visible');

  // Stop walking
  dog.wrapper.classList.remove('walking');

  // Happy animation
  dog.el.classList.add('fed');
  playHappy();

  // Show happy bark
  dog.bark.textContent = '‚ù§Ô∏è Yum!';
  dog.bark.classList.add('visible');
  setTimeout(() => dog.bark.classList.remove('visible'), 1500);

  // Show message after delay
  setTimeout(() => {
    showMessage(dog.message);
  }, 800);
}

// ============ MESSAGE OVERLAY ============
function showMessage(text) {
  document.getElementById('msg-text').textContent = text;
  document.getElementById('message-overlay').classList.add('active');
}

function closeMessage(e) {
  if (e && e.target !== document.getElementById('message-overlay') && !e.target.classList.contains('close-btn')) return;
  document.getElementById('message-overlay').classList.remove('active');

  // Check if all fed
  if (fedCount === dogs.length) {
    setTimeout(showFinale, 600);
  }
}

function showFinale() {
  document.getElementById('msg-text').innerHTML = 'üéâ All the pups are happy & fed! üéâ<br><br><span style="font-family:Caveat,cursive;font-size:28px;">I love you to the moon and back! üåôüêæ</span><br><br><button class="surprise-btn" onclick="goToSurprise()">One more surprise... üêæ</button>';
  document.getElementById('message-overlay').classList.add('active');
  // Burst of hearts
  for (let i = 0; i < 30; i++) {
    setTimeout(() => createFloatingHeart(), i * 100);
  }
}

function goToSurprise() {
  document.getElementById('message-overlay').classList.remove('active');
  // Fade out current scene
  document.body.style.transition = 'opacity 0.6s';
  document.body.style.opacity = '0';
  setTimeout(() => {
    document.body.innerHTML = '';
    document.body.style.opacity = '1';
    buildFartPage();
  }, 700);
}

function buildFartPage() {
  document.body.style.overflow = 'hidden';
  document.body.style.margin = '0';
  document.body.innerHTML = `
  <style>
    #fart-scene {
      position: fixed; inset: 0;
      background: linear-gradient(180deg, #87ceeb 0%, #e0f0ff 50%, #7cb342 50.5%, #558b2f 70%, #33691e 100%);
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      font-family: 'Caveat', cursive;
    }
    #fart-container {
      position: relative;
      width: 700px; height: 400px;
      margin-top: 10vh;
    }
    #fart-dog {
      position: absolute;
      left: 60px; bottom: 20px;
      animation: fartDogBounce 0.5s ease-in-out infinite alternate;
    }
    @keyframes fartDogBounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-4px); }
    }
    /* Fart cloud container */
    #fart-cloud-group {
      position: absolute;
      right: 20px; bottom: 40px;
      opacity: 0;
      animation: fartAppear 1s ease 1.2s forwards;
    }
    @keyframes fartAppear {
      0% { opacity: 0; transform: scale(0.3) translateX(-80px); }
      50% { opacity: 0.9; }
      100% { opacity: 1; transform: scale(1) translateX(0); }
    }
    .fart-cloud {
      position: relative;
      width: 280px; height: 180px;
    }
    .fart-blob {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(ellipse at center, #7ec87e 0%, #4a9e4a 40%, #2d7a2d 100%);
      opacity: 0.55;
      filter: blur(6px);
      animation: fartPulse 2s ease-in-out infinite alternate;
    }
    @keyframes fartPulse {
      0% { transform: scale(1); opacity: 0.5; }
      100% { transform: scale(1.08); opacity: 0.65; }
    }
    .fart-blob:nth-child(1) { width: 160px; height: 110px; top: 35px; left: 50px; animation-delay: 0s; }
    .fart-blob:nth-child(2) { width: 120px; height: 90px; top: 20px; left: 90px; animation-delay: 0.3s; }
    .fart-blob:nth-child(3) { width: 100px; height: 80px; top: 55px; left: 20px; animation-delay: 0.6s; }
    .fart-blob:nth-child(4) { width: 80px; height: 60px; top: 10px; left: 40px; animation-delay: 0.9s; }
    .fart-blob:nth-child(5) { width: 70px; height: 55px; top: 70px; left: 110px; animation-delay: 0.4s; }
    /* Stink lines */
    .stink-line {
      position: absolute;
      width: 3px;
      background: #5aad5a;
      border-radius: 2px;
      opacity: 0;
      animation: stinkRise 2s ease-in-out infinite;
    }
    @keyframes stinkRise {
      0% { opacity: 0; transform: translateY(0) scaleY(0.5); }
      30% { opacity: 0.5; }
      100% { opacity: 0; transform: translateY(-50px) scaleY(1.2); }
    }
    .stink-line:nth-child(6) { height: 25px; left: 80px; top: 5px; animation-delay: 0s; }
    .stink-line:nth-child(7) { height: 30px; left: 130px; top: 0px; animation-delay: 0.5s; }
    .stink-line:nth-child(8) { height: 20px; left: 180px; top: 10px; animation-delay: 1s; }
    .stink-line:nth-child(9) { height: 22px; left: 60px; top: 15px; animation-delay: 1.3s; }
    .stink-line:nth-child(10) { height: 28px; left: 200px; top: 5px; animation-delay: 0.7s; }

    /* Fart text bubble */
    #fart-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      font-family: 'Caveat', cursive;
      font-size: clamp(22px, 4vw, 34px);
      font-weight: 700;
      color: #1a5e1a;
      text-align: center;
      text-shadow: 0 1px 4px rgba(255,255,255,0.5);
      line-height: 1.3;
      pointer-events: none;
      white-space: nowrap;
    }
    /* little connector tail from cloud to dog butt */
    #fart-tail {
      position: absolute;
      left: -30px; bottom: 50px;
      width: 50px; height: 30px;
      pointer-events: none;
      transform: scaleX(-1);
    }
    /* Page title */
    #fart-title {
      position: fixed;
      top: 30px; left: 50%;
      transform: translateX(-50%);
      font-family: 'Caveat', cursive;
      font-size: clamp(28px, 5vw, 52px);
      color: #5c3a21;
      text-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 100;
      animation: titlePop 0.8s cubic-bezier(.34,1.56,.64,1) forwards;
      opacity: 0;
      text-align: center;
    }
    @keyframes titlePop {
      0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
      100% { opacity: 1; transform: translateX(-50%) scale(1); }
    }
    /* Floating stink emojis */
    .stink-emoji {
      position: absolute;
      font-size: 24px;
      opacity: 0;
      animation: emojiFloat 4s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes emojiFloat {
      0% { opacity: 0; transform: translateY(0) rotate(0deg); }
      20% { opacity: 0.7; }
      100% { opacity: 0; transform: translateY(-120px) rotate(30deg); }
    }
    #back-btn {
      position: fixed;
      bottom: 24px; left: 50%;
      transform: translateX(-50%);
      font-family: 'Caveat', cursive;
      font-size: 20px;
      background: #c9485b;
      color: white;
      border: none;
      border-radius: 30px;
      padding: 12px 36px;
      cursor: pointer;
      z-index: 100;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    #back-btn:hover { background: #8b1a2b; transform: translateX(-50%) scale(1.05); }
  </style>

  <div id="fart-scene">
    <div id="fart-title">üí® A Special Message... üí®</div>

    <div id="fart-container">
      <!-- Fart cloud -->
      <div id="fart-cloud-group">
        <div class="fart-cloud">
          <div class="fart-blob"></div>
          <div class="fart-blob"></div>
          <div class="fart-blob"></div>
          <div class="fart-blob"></div>
          <div class="fart-blob"></div>
          <div class="stink-line"></div>
          <div class="stink-line"></div>
          <div class="stink-line"></div>
          <div class="stink-line"></div>
          <div class="stink-line"></div>
          <div id="fart-text">‚ú® You are my<br>favorite fart ‚ú®</div>
        </div>
        <!-- Tail connector (small cloud puffs) -->
        <svg id="fart-tail" viewBox="0 0 50 30">
          <circle cx="10" cy="20" r="8" fill="#7ec87e" opacity="0.4"/>
          <circle cx="28" cy="15" r="6" fill="#7ec87e" opacity="0.3"/>
          <circle cx="42" cy="12" r="4" fill="#7ec87e" opacity="0.2"/>
        </svg>
      </div>

      <!-- Dachshund (facing left so butt faces the cloud) -->
      <div id="fart-dog">
        <svg viewBox="0 0 200 130" width="220" height="143">
          <g transform="scale(-1,1) translate(-200,0)">
            <ellipse cx="100" cy="118" rx="60" ry="6" fill="rgba(0,0,0,0.12)"/>
            <rect x="42" y="88" width="11" height="28" rx="5" fill="#5c3a21"/>
            <rect x="55" y="88" width="11" height="28" rx="5" fill="#6b4423"/>
            <ellipse cx="47" cy="116" rx="8" ry="4.5" fill="#3e2712"/>
            <ellipse cx="60" cy="116" rx="8" ry="4.5" fill="#4a2f16"/>
            <rect x="128" y="88" width="11" height="28" rx="5" fill="#5c3a21"/>
            <rect x="141" y="88" width="11" height="28" rx="5" fill="#6b4423"/>
            <ellipse cx="133" cy="116" rx="8" ry="4.5" fill="#3e2712"/>
            <ellipse cx="146" cy="116" rx="8" ry="4.5" fill="#4a2f16"/>
            <path d="M30,74 Q18,55 24,42" stroke="#5c3a21" stroke-width="6" fill="none" stroke-linecap="round"/>
            <ellipse cx="98" cy="80" rx="62" ry="22" fill="#6b4423"/>
            <ellipse cx="98" cy="78" rx="59" ry="20" fill="#7a5230"/>
            <ellipse cx="98" cy="85" rx="44" ry="9" fill="#8b6340" opacity="0.5"/>
            <ellipse cx="145" cy="78" rx="20" ry="20" fill="#7a5230"/>
            <ellipse cx="165" cy="60" rx="22" ry="20" fill="#6b4423"/>
            <ellipse cx="165" cy="58" rx="21" ry="18" fill="#7a5230"/>
            <ellipse cx="182" cy="64" rx="13" ry="10" fill="#8b6340"/>
            <ellipse cx="182" cy="62" rx="12" ry="8" fill="#926b48"/>
            <ellipse cx="191" cy="61" rx="4.5" ry="3.5" fill="#2a1a0a"/>
            <ellipse cx="190" cy="60" rx="1.8" ry="1.2" fill="#5a3a1a" opacity="0.4"/>
            <ellipse cx="169" cy="53" rx="5" ry="5.5" fill="#1a0f05"/>
            <ellipse cx="170" cy="51.5" rx="2" ry="2.2" fill="white" opacity="0.6"/>
            <ellipse cx="167" cy="47" rx="7" ry="1.8" fill="#5c3a21"/>
            <ellipse cx="156" cy="49" rx="13" ry="20" fill="#5c3a21" transform="rotate(-15,156,49)"/>
            <ellipse cx="156" cy="51" rx="10" ry="16" fill="#4a2f16" transform="rotate(-15,156,51)"/>
            <!-- Cheeky smile -->
            <path d="M178,67 Q183,72 190,68" stroke="#4a2f16" stroke-width="1.5" fill="none"/>
            <rect x="136" y="72" width="24" height="7" rx="3.5" fill="#c9485b"/>
            <circle cx="148" cy="79" r="4" fill="#d4a574" stroke="#b8944a" stroke-width="0.5"/>
          </g>
        </svg>
      </div>
    </div>

    <button id="back-btn" onclick="location.reload()">üêæ Back to the pups!</button>
  </div>
  `;

  // Add floating stink emojis
  const fartScene = document.getElementById('fart-scene');
  const emojis = ['üí®', 'üíö', 'ü§¢', 'üòÇ', 'üí®', 'üêæ'];
  setInterval(() => {
    const em = document.createElement('div');
    em.className = 'stink-emoji';
    em.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    em.style.left = (20 + Math.random() * 50) + '%';
    em.style.bottom = '30%';
    em.style.animationDuration = (3 + Math.random() * 3) + 's';
    em.style.animationDelay = '0s';
    fartScene.appendChild(em);
    setTimeout(() => em.remove(), 6000);
  }, 1200);

  // Fart sound
  try {
    const ac = new (window.AudioContext || window.webkitAudioContext)();
    setTimeout(() => {
      // Low rumble fart sound
      const bufferSize = ac.sampleRate * 0.8;
      const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        const t = i / ac.sampleRate;
        const env = Math.exp(-t * 3) * 0.15;
        data[i] = (Math.random() * 2 - 1) * env * (Math.sin(t * 80) * 0.5 + 0.5);
      }
      const source = ac.createBufferSource();
      source.buffer = buffer;
      const lp = ac.createBiquadFilter();
      lp.type = 'lowpass';
      lp.frequency.value = 200;
      source.connect(lp);
      lp.connect(ac.destination);
      source.start();
    }, 1200);
  } catch(e) {}
}

// ============ DRAG & DROP ============
function startDrag(e) {
  initAudio();
  e.preventDefault();
  const pos = getEventPos(e);

  // Create draggable treat clone
  const clone = document.getElementById('treat-source').cloneNode(true);
  clone.id = '';
  clone.classList.add('treat', 'dragging');
  clone.style.left = (pos.x - 25) + 'px';
  clone.style.top = (pos.y - 25) + 'px';
  document.body.appendChild(clone);
  dragging = clone;
  dragOffsetX = 0;
  dragOffsetY = 0;
}

function moveDrag(e) {
  if (!dragging) return;
  e.preventDefault();
  const pos = getEventPos(e);
  dragging.style.left = (pos.x - 25) + 'px';
  dragging.style.top = (pos.y - 25) + 'px';
}

function endDrag(e) {
  if (!dragging) return;
  const pos = getEventPos(e);

  // Check if over a dog
  let hitDog = null;
  for (const dog of dogs) {
    if (dog.fed) continue;
    const rect = dog.el.getBoundingClientRect();
    if (pos.x >= rect.left && pos.x <= rect.right && pos.y >= rect.top && pos.y <= rect.bottom) {
      hitDog = dog;
      break;
    }
  }

  if (hitDog) {
    feedDog(hitDog);
  }

  dragging.remove();
  dragging = null;
}

function getEventPos(e) {
  if (e.touches && e.touches.length > 0) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
  if (e.changedTouches && e.changedTouches.length > 0) return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
  return { x: e.clientX, y: e.clientY };
}

// ============ FLOATING HEARTS ============
function createFloatingHeart() {
  const heart = document.createElement('div');
  heart.className = 'floating-heart';
  heart.textContent = ['üíï', 'üíó', 'üíñ', '‚ù§Ô∏è', 'üíò'][Math.floor(Math.random() * 5)];
  heart.style.left = Math.random() * 100 + '%';
  heart.style.bottom = '0';
  heart.style.fontSize = (14 + Math.random() * 18) + 'px';
  heart.style.animationDuration = (6 + Math.random() * 6) + 's';
  document.getElementById('scene').appendChild(heart);
  setTimeout(() => heart.remove(), 12000);
}

// ============ MALLARD DUCK ============
function createMallardSVG() {
  return `<svg viewBox="0 0 130 80" width="130" height="80">
    <!-- Body -->
    <ellipse cx="60" cy="45" rx="32" ry="16" fill="#5c4a3a"/>
    <ellipse cx="60" cy="43" rx="30" ry="14" fill="#6b5a48"/>
    <!-- Belly / breast -->
    <ellipse cx="75" cy="48" rx="18" ry="12" fill="#5a3a2a"/>
    <ellipse cx="78" cy="46" rx="15" ry="10" fill="#6b4030"/>
    <!-- Speculum (blue wing patch) -->
    <rect x="42" y="38" width="18" height="5" rx="2" fill="#1a5276" opacity="0.8"/>
    <rect x="42" y="43" width="18" height="2" rx="1" fill="#fff" opacity="0.5"/>
    <!-- Tail feathers -->
    <path d="M28,42 Q18,40 14,36" stroke="#3e3028" stroke-width="3" fill="none" stroke-linecap="round"/>
    <path d="M28,44 Q20,44 16,42" stroke="#4a3a2e" stroke-width="2.5" fill="none" stroke-linecap="round"/>
    <path d="M28,40 Q20,36 17,30" stroke="#3e3028" stroke-width="2" fill="none" stroke-linecap="round"/>
    <!-- Curl tail feather (male mallard signature) -->
    <path d="M26,38 Q20,32 22,26 Q24,30 28,34" fill="#2a2420" stroke="#1a1610" stroke-width="0.5"/>
    <!-- Neck -->
    <ellipse cx="90" cy="38" rx="10" ry="14" fill="#0d5e2e"/>
    <ellipse cx="90" cy="36" rx="9" ry="12" fill="#0f6e34"/>
    <!-- White neck ring -->
    <path d="M82,46 Q90,50 98,46" stroke="white" stroke-width="2" fill="none" opacity="0.8"/>
    <!-- Head -->
    <ellipse cx="100" cy="28" rx="14" ry="12" fill="#0d5e2e"/>
    <ellipse cx="100" cy="27" rx="13" ry="11" fill="#0f6e34"/>
    <!-- Iridescent head sheen -->
    <ellipse cx="98" cy="25" rx="8" ry="7" fill="#1a8c4e" opacity="0.3"/>
    <ellipse cx="102" cy="23" rx="4" ry="3" fill="#2aad5e" opacity="0.2"/>
    <!-- Eye -->
    <circle cx="105" cy="25" r="2.5" fill="#1a0f05"/>
    <circle cx="105.8" cy="24.2" r="0.8" fill="white" opacity="0.6"/>
    <!-- Bill -->
    <path d="M112,28 L128,30 Q130,32 128,34 L112,33 Z" fill="#c4a832"/>
    <path d="M112,28 L126,29.5 Q128,30.5 126,31.5 L112,30.5 Z" fill="#d4b842" opacity="0.6"/>
    <line x1="112" y1="30.5" x2="127" y2="31.5" stroke="#9a8422" stroke-width="0.5" opacity="0.6"/>
    <!-- Nostril -->
    <ellipse cx="118" cy="30" rx="1" ry="0.6" fill="#8a7418"/>
    <!-- Wing (top, animated) -->
    <g class="wing-top">
      <path d="M50,38 Q55,18 75,12 Q65,20 58,32 Z" fill="#5c4a3a"/>
      <path d="M52,36 Q56,22 70,16 Q63,23 57,32 Z" fill="#6b5a48"/>
      <!-- Wing feather details -->
      <line x1="54" y1="30" x2="62" y2="20" stroke="#4a3a2e" stroke-width="0.5" opacity="0.4"/>
      <line x1="52" y1="33" x2="58" y2="24" stroke="#4a3a2e" stroke-width="0.5" opacity="0.4"/>
    </g>
    <!-- Feet (tucked in flight) -->
    <path d="M65,56 L68,62 L72,60" stroke="#d4822a" stroke-width="1.5" fill="none"/>
    <path d="M60,55 L62,61 L66,59" stroke="#d4822a" stroke-width="1.5" fill="none"/>
  </svg>`;
}

function spawnMallard() {
  const scene = document.getElementById('scene');
  const duck = document.createElement('div');
  duck.className = 'mallard';
  duck.innerHTML = createMallardSVG();

  // Random height in the sky area (top 45%)
  const skyHeight = window.innerHeight * 0.42;
  const y = 30 + Math.random() * (skyHeight - 80);
  duck.style.top = y + 'px';
  duck.style.left = '-220px';

  // Fly speed: 12-20 seconds to cross
  const duration = 12 + Math.random() * 8;
  duck.style.transition = `transform ${duration}s linear`;
  scene.appendChild(duck);

  // Start flight after a frame
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      duck.style.transform = `translateX(${window.innerWidth + 250}px)`;
    });
  });

  // Remove after crossing
  setTimeout(() => duck.remove(), (duration + 1) * 1000);
}

// ============ CLOUDS ============
function createClouds() {
  const scene = document.getElementById('scene');
  for (let i = 0; i < 5; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';
    const size = 60 + Math.random() * 80;
    cloud.style.width = size + 'px';
    cloud.style.height = (size * 0.5) + 'px';
    cloud.style.top = (5 + Math.random() * 30) + '%';
    cloud.style.left = (Math.random() * 90) + '%';
    cloud.style.opacity = 0.5 + Math.random() * 0.3;
    scene.appendChild(cloud);
  }
}

// ============ DRAW GRASS DETAIL ============
function drawGrass() {
  const canvas = document.getElementById('grass-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight * 0.45;

  // Draw individual grass blades
  for (let i = 0; i < 600; i++) {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;
    const h = 10 + Math.random() * 25;
    const lean = (Math.random() - 0.5) * 12;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.quadraticCurveTo(x + lean * 0.5, y - h * 0.5, x + lean, y - h);
    ctx.strokeStyle = `hsl(${95 + Math.random() * 25}, ${50 + Math.random() * 30}%, ${30 + Math.random() * 20}%)`;
    ctx.lineWidth = 1 + Math.random();
    ctx.stroke();
  }

  // Small flowers
  for (let i = 0; i < 30; i++) {
    const x = Math.random() * canvas.width;
    const y = 20 + Math.random() * (canvas.height - 40);
    ctx.beginPath();
    ctx.arc(x, y, 2.5, 0, Math.PI * 2);
    ctx.fillStyle = ['#f4c2c2', '#fff', '#ffeb3b', '#e1bee7', '#c9485b'][Math.floor(Math.random() * 5)];
    ctx.fill();
  }
}

// ============ INIT ============
function init() {
  document.getElementById('total-count').textContent = MESSAGES.length;
  createClouds();
  drawGrass();

  for (let i = 0; i < MESSAGES.length; i++) {
    dogs.push(createDog(i));
  }

  // Periodic floating hearts
  setInterval(() => createFloatingHeart(), 4000);

  // Spawn mallard ducks
  setTimeout(() => spawnMallard(), 2000);
  setInterval(() => spawnMallard(), 15000 + Math.random() * 10000);

  // Treat drag events
  const treat = document.getElementById('treat-source');
  treat.addEventListener('mousedown', startDrag);
  treat.addEventListener('touchstart', startDrag, { passive: false });
  document.addEventListener('mousemove', moveDrag);
  document.addEventListener('touchmove', moveDrag, { passive: false });
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchend', endDrag);

  // Resize
  window.addEventListener('resize', () => {
    drawGrass();
  });
}

window.addEventListener('load', init);
// Also init audio on first interaction
document.addEventListener('click', initAudio, { once: true });
document.addEventListener('touchstart', initAudio, { once: true });
</script>
</body>
</html>
